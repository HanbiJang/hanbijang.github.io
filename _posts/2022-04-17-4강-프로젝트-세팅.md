---
layout: post
title: 4ê°• í”„ë¡œì íŠ¸ ì„¸íŒ…

categories: [DirectX12]
tags: [DirectX12]
render_with_liquid: false
---

# 4ê°• í”„ë¡œì íŠ¸ ì„¤ì •

## í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° & ì„¤ì •í•˜ê¸°

### [1]

![Untitled](https://user-images.githubusercontent.com/68460391/163723530-dcff30fe-3198-4116-920d-2d44ec7cedbb.png)
í”„ë¡œì íŠ¸ ìƒì„± - C++ ì–¸ì–´ ì„¤ì • - Window ë°ìŠ¤í¬íƒ‘ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° - **ì •ì  ë¼ì´ë¸ŒëŸ¬ë¦¬** íƒ€ì…ì˜ í”„ë¡œì íŠ¸ ì¶”ê°€  (ì´ë¦„ì€ Engine)

 - í•„í„° ì¶”ê°€ (Engine, Resource, Utils) - í•œê¸€ í´ë” ì œê±° - Utilsí•„í„°ì— ì†ŒìŠ¤ì½”ë“œë“¤ ì¶”ê°€  - Engine.cpp ì œê±° (í•„ìš” ì—†ë‹¤)

### DLL(ë™ì  ë¼ì´ë¸ŒëŸ¬ë¦¬)ì™€ ì •ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì°¨ì´ì 



DLL : ëŸ°íƒ€ì„ì— ì—°ê²°ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

ì •ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ : ì†ŒìŠ¤ ì½”ë“œë¥¼ ë¹Œë“œí• ë•Œ í¬í•¨ë˜ì–´ ì—°ê²°ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

### ë¼ì´ë¸ŒëŸ¬ë¦¬(ì—”ì§„)ì„ ë¶„ë¦¬í•˜ëŠ” ì´ìœ 

í´ë¼ì´ì–¸íŠ¸ (ì»¨í…ì¸  ë¶€ë¶„) ê³¼ ì—”ì§„ ë¶€ë¶„ì„ ë‚˜ëˆ„ê¸° ìœ„í•¨ì´ë‹¤

ë¹Œë“œ ì‹œ ì—®ì—¬ìˆëŠ” ìƒí™©ì´ ë  ê²ƒ. ì˜ˆì‹œë¡œ ì—”ì§„ ìˆ˜ì • ì‹œ í´ë¼ì´ì–¸íŠ¸ê¹Œì§€ ë¹Œë“œë¥¼ í•´ì•¼ í•¨ â‡’ ìµœì•…ğŸ¤®

[2] Engine í”„ë¡œì íŠ¸ì˜ íŠ¹ì§•

- ë©”ì¸ í•¨ìˆ˜ê°€ ì—†ë‹¤

    ê¸°ëŠ¥ ëª¨ìŒì§‘ (=ë¼ì´ë¸ŒëŸ¬ë¦¬) ì´ê¸° ë•Œë¬¸ì´ë‹¤


ë‹¤ìŒì„ pch.h (í”„ë¦¬ ì»´íŒŒì¼ëœ í—¤ë”) ì— ì½”ë”©í•˜ê³  framework.h ì œê±°

```csharp
// framework.hì˜ ìœ ì¼í•œ í•œì¤„ ì½”ë“œì…ë‹ˆë‹¤

#define WIN32_LEAN_AND_MEAN             // ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë‚´ìš©ì„ Windows í—¤ë”ì—ì„œ ì œì™¸í•©ë‹ˆë‹¤.
```

(ê²°ê³¼) - pch.h

```csharp
#ifndef PCH_H
#define PCH_H

#define WIN32_LEAN_AND_MEAN             // ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë‚´ìš©ì„ Windows í—¤ë”ì—ì„œ ì œì™¸í•©ë‹ˆë‹¤.

#endif //PCH_H
```



 - Utils ì— í´ë˜ìŠ¤ ì¶”ê°€ (EnginePch)

![Untitled](https://user-images.githubusercontent.com/68460391/163723536-a81c4d2e-433a-4719-b4a4-3dfdc8c225f0.png)



 - EnginePch.h ì— ë‹¤ìŒ ì½”ë”© (ì•ìœ¼ë¡œ ì‚¬ìš©í•˜ê²Œ ë  ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤)

```csharp
#pragma once

// ê°ì¢… include
#include <windows.h>
#include <tchar.h>
#include <memory>
#include <string>
#include <vector>
#include <array>
#include <list>
#include <map>
using namespace std;

#include "d3dx12.h"
#include <d3d12.h>
#include <wrl.h>
#include <d3dcompiler.h>
#include <dxgi.h>
#include <DirectXMath.h>
#include <DirectXPackedVector.h>
#include <DirectXColors.h>
using namespace DirectX;
using namespace DirectX::PackedVector;
using namespace Microsoft::WRL;

// ê°ì¢… lib (ë¼ì´ë¸ŒëŸ¬ë¦¬)
#pragma comment(lib, "d3d12")
#pragma comment(lib, "dxgi")
#pragma comment(lib, "dxguid")
#pragma comment(lib, "d3dcompiler")

// ê°ì¢… typedef ì˜¤ë¥¸ìª½ì˜ í˜•ì„ ì™¼ìª½ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨
using int8		= __int8;
using int16		= __int16;
using int32		= __int32;
using int64		= __int64;
using uint8		= unsigned __int8;
using uint16	= unsigned __int16;
using uint32	= unsigned __int32;
using uint64	= unsigned __int64;
using Vec2		= XMFLOAT2;
using Vec3		= XMFLOAT3;
using Vec4		= XMFLOAT4;
using Matrix	= XMMATRIX;

void HelloEngine();
```

ë‚´ìš© ì¤‘ `#include "d3dx12.h"`

ì´ íŒŒì¼ì€ ì—†ìŒ! [ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ d3dx12.híŒŒì¼ ê¹ƒí—ˆë¸Œ]([https://github.com/microsoft/DirectX-Graphics-Samples/blob/master/Libraries/D3D12RaytracingFallback/Include/d3dx12.h](https://github.com/microsoft/DirectX-Graphics-Samples/blob/master/Libraries/D3D12RaytracingFallback/Include/d3dx12.h))

ì´ ê³³ì—ì„œ ì§ì ‘ ë‹¤ìš´ ë°›ì•„ì„œ í”„ë¡œì íŠ¸ì— ë„£ì–´ì•¼ í•¨ !

- ë§ˆì´í¬ë¡œ ì†Œí”„íŠ¸ì—ì„œ ì§€ì›í•´ì£¼ëŠ” ë¹„ ê³µì‹ì  ìœ í‹¸ë¦¬í‹° ë¼ì´ë¸ŒëŸ¬ë¦¬
- í¸ë¦¬í•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ë“¤ì´ ëª¨ì—¬ìˆìŒ

ì´ì œ Engine.cpp ì•ˆì˜ ë‹¤ìŒ `HelloEngine()`ì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¶€ë¥¼ ìˆ˜ ìˆê²Œ í•  ê²ƒ

```csharp
#include "pch.h"
#include "EnginePch.h"

void HelloEngine()
{

}
```

 - pch.h ì— ë‹¤ìŒ ì¶”ê°€

```csharp
#include "EnginePch.h"
```

- EnginePch.hì€ ê³µìš© í—¤ë”ë¡œì¨, ë‚˜ì¤‘ì— í´ë¼ì´ì–¸íŠ¸ì—ì„œ EnginePch.h ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ë”°ë¡œ ë¶„ë¦¬ë¥¼ í•˜ì˜€ë‹¤

### ë¹Œë“œí•´ë³´ê¸°

ë¹Œë“œë¥¼ í•˜ë©´ í”„ë¡œì íŠ¸ í´ë”ì˜ x64 - Debug í´ë” ì•ˆì— ë‚´ìš©ë¬¼ì´ ë§Œë“¤ì–´ì§„ë‹¤.

![Untitled](https://user-images.githubusercontent.com/68460391/163723551-2d7639e5-c114-49d0-99e7-f47fa1e6b47e.png)

- `Engine.lib` íŒŒì¼
    - í›„ì— ì´ íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©í•˜ê²Œ ëœë‹¤

- Client.exe íŒŒì¼ì€ ì‹¤í–‰í•  ìˆ˜ ìˆì§€ë§Œ, EngineíŒŒì¼ì€ ê·¸ë ‡ì§€ ì•ŠìŒ. ì°¨ì´ê°€ ìˆë‹¤

### [2]

**Client ì„¤ì •**

Client í”„ë¡œì íŠ¸ (ìš°í´ë¦­) ì†ì„±ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •

 - ë¯¸ë¦¬ ì»´íŒŒì¼ëœ í—¤ë” - ì‚¬ìš© ì„¤ì •, pch.h ë¥¼ ë¯¸ë¦¬ ì»´íŒŒì¼ëœ í—¤ë” íŒŒì¼ë¡œ ì„¤ì •

 - í”Œë«í¼ì„ x64ë¡œ ì„¤ì •

![Untitled](https://user-images.githubusercontent.com/68460391/163723570-6a00a2cc-d3b3-4e9a-a0a9-2effa80e1651.png)

Client (ìš°í´ë¦­) í´ë˜ìŠ¤ ì¶”ê°€ - pch í´ë˜ìŠ¤ ì¶”ê°€

 - Client í•„í„° ì¶”ê°€ Game, Utils - Utils ì— ëª¨ë“  ì†ŒìŠ¤ì½”ë“œ ë„£ê¸° - `í—¤ë”íŒŒì¼` í´ë” ì‚­ì œ

ìƒì„±í•œ pch.cpp ì—ì„œ ì†ì„± í˜ì´ì§€ - c/c++ ì„¤ì • - ë¯¸ë¦¬ì»´íŒŒì¼ëœ í—¤ë” : ë§Œë“¤ê¸° ì„¤ì •

ì•ìœ¼ë¡œ ìƒì„±í•  cpp íŒŒì¼ë“¤ì—ì„œ ë‹¤ìŒ í—¤ë”ë¥¼ **ê°€ì¥ ìƒìœ„ì—** ì¶”ê°€ í•´ì•¼ í•¨

- ì•ˆ í•˜ë©´ ì—ëŸ¬ê°€ ë‚œë‹¤

```csharp
#include "pch.h"
```

### [3] pch.h ì„¤ëª…

```csharp
#pragma once

#pragma comment(lib, "Engine.lib")

#include "EnginePch.h"
```

`#include "EnginePch.h"` ì—ì„œ ì—ëŸ¬ê°€ ë‚˜ëŠ” ì´ìœ  ğŸ”¥ğŸ”¥ğŸ”¥

- Engine í´ë”ì™€  Client í´ë”ì˜ ê²½ë¡œê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ â‡’ ê²½ë¡œë¥¼ ì„¤ì •í•´ ì£¼ì–´ì•¼ í•œë‹¤!

### [4] ë¹Œë“œ ê²°ê³¼ë¬¼ì´ (x64 í´ë” ë§ê³ ) ë‹¤ë¥¸ í´ë”ì— ë§Œë“¤ì–´ì§€ê²Œ í•  ë•Œ, ì‚¬ì „ ì„¸íŒ…

ì›í•˜ëŠ” í”„ë¡œì íŠ¸ ( ì—¬ê¸°ì„  Engine í”„ë¡œì íŠ¸) - ì†ì„± - êµ¬ì„± ì†ì„± - ì¼ë°˜ - ì¶œë ¥ ë””ë ‰í„°ë¦¬

ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •  

`$(SolutionDir)[í´ë”ëª…]\`

ì´ë ‡ê²Œ í•˜ë©´ ë¹Œë“œ í›„ [í´ë”ëª…] ì— Engine í”„ë¡œì íŠ¸ ë¹Œë“œ ê²°ê³¼ê°€ ì €ì¥ì´ ëœë‹¤

### [5] í´ë¼ì´ì–¸íŠ¸ì—ì„œ Engine ì˜ ì½”ë“œë“¤ì„ ì‚¬ìš©í•˜ê¸°

í´ë¼ì´ì–¸íŠ¸ì—ì„œ Engine ì˜ ì½”ë“œë“¤ì„ ì‚¬ìš©í•˜ê¸°

â‡’ ì—”ì§„ì˜ [1] **í—¤ë” íŒŒì¼ë“¤ì˜ ê²½ë¡œì™€ [2] ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ì˜ ê²½ë¡œ [3] ì‚¬ìš©í•  íŒŒì¼ë“¤ì˜ ê²½ë¡œ**ë¥¼ ì•Œë ¤ì£¼ì–´ì•¼ í•¨

[1] Client ì†ì„± - C/C++ ì¼ë°˜ - ì¶”ê°€ í¬í•¨ ë””ë ‰í„°ë¦¬

- `$(SolutionDir)Engine\`

[2] Client ì†ì„± - ë§ì»¤ - ì¼ë°˜ - ì¶”ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë””ë ‰í„°ë¦¬

- `$(SolutionDir)Output\`
    - ìœ„ [4]ë‹¨ê³„ì—ì„œ ë¹Œë“œ ê²°ê³¼ë¬¼ì´ ìˆëŠ” í´ë” ëª…ì„ ì¨ì•¼ í•¨


[3] ì‚¬ìš©í•  íŒŒì¼ë“¤ì„ ì•Œë ¤ì£¼ê¸°

pch.h ì— `#include "EnginePch.h"` ìœ—ì¤„ì— ë‹¤ìŒ ì½”ë”©

`#pragma comment(lib, â€œEngine.libâ€)`

- ì „ì²˜ë¦¬ê¸° ë‹¨ê³„ì—ì„œ ë¹Œë“œí•˜ê¸° ì „ì— `â€œEngine.libâ€` íŒŒì¼ì„ ì‚¬ìš©í•  ê²ƒì„ ìš”ì²­í•¨

â‡’ ì´ ë‹¨ê³„ê¹Œì§€ ëë‚˜ë©´ **[3] pch.h ì„¤ëª…**ì—ì„œ ë‚¬ë˜ ì—ëŸ¬ê°€ ì‚¬ë¼ì§„ë‹¤! ğŸ”¥ğŸ”¥ğŸ”¥

## í´ë¼ì´ì–¸íŠ¸ì—ì„œ Engine ì˜ í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°

- ê¸°ëŠ¥ ì¶”ê°€ëŠ” X

### [1]

Game í´ë” - ì¶”ê°€ í´ë˜ìŠ¤ - Game í´ë˜ìŠ¤ ì¶”ê°€

ì—¬ê¸°ì„œ ë§Œë“¤ì—ˆë˜ Game.cpp íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ì½”ë”© â‡’ ì—”ì§„ì— ìˆë˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ ë§Œë“¤ì–´ë³´ì

**ğŸ”½ Game.cpp**

```csharp
#include "pch.h"
#include "Game.h"

void Game::Init()
{
	HelloEngine();
}

void Game::Update()
{

}
```

- `HelloEngine();`  : Engine.cpp ì— ìˆë˜ í•¨ìˆ˜ì´ë‹¤ ! âœ¨

### [2]

`Client.cpp` íŒŒì¼ì—ì„œ `wWinMain`ë©”ì¸ í•¨ìˆ˜ ì•ˆì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë¬´í•œë£¨í”„ë¥¼ ëŒë©° ê¸°ëŠ¥ì„ ìˆ˜í–‰ ì¤‘ì´ë‹¤

(ë¼ê³  ê¹Œì§€ë§Œ ëŒ€ê°• ì•Œê³  ìˆì)

```csharp
while (GetMessage(&msg, nullptr, 0, 0))
    {
        if (PeekMessage(&msg, nullptr, 0, 0, PM_REMOVE))
        {
            if (msg.message == WM_QUIT)
                break;

			if (!TranslateAccelerator(msg.hwnd, hAccelTable, &msg))
			{
				TranslateMessage(&msg);
				DispatchMessage(&msg);
			}
        }

		// TODO
        game->Update();
    }
```

ğŸ”¼ ë¬´í•œ ë£¨í”„ë¬¸

`Game` í´ë˜ìŠ¤ ë‚´ìš©ì„ ë©”ì¸í•¨ìˆ˜ `wWinMain`ì—ì„œ í˜¸ì¶œí•˜ê¸°

â‡’ ë‹¤ìŒì„ `wWinMain` ì˜ while ë¬´í•œë£¨í”„ ìœ„ì— ì½”ë”©

```csharp
unique_ptr<Game> game = make_unique<Game>(); //Game í´ë˜ìŠ¤ ë§Œë“¤ê¸°
game->Init(); //ì´ˆê¸°í™” ì‹œí‚¤ê¸°
```

ë‹¤ìŒì„ `wWinMain` ì˜ while ë¬´í•œë£¨í”„ **ì•ˆ**ì— ì½”ë”©

```csharp
game->Update(); //ê°±ì‹ í•˜ê¸°
```

- Game ì´ while ë¬¸ì´ ë„ëŠ” ì£¼ê¸° (í”„ë ˆì„) ë§Œí¼ ê°±ì‹ ì´ ëœë‹¤

### [3]

```csharp
while (GetMessage(&msg, nullptr, 0, 0)) {
	if (PeekMessage(&msg, nullptr, 0, 0, PM_REMOVE))
	...
}
```

ë‹¤ìŒì€  ë§ˆìš°ìŠ¤ë‚˜ í‚¤ë³´ë“œì˜ ì…ë ¥ ë“± *ì´ë²¤íŠ¸*ê°€  ìˆì„ ì‹œ `GetMessage`ë¡œ ê¹¨ì–´ë‚˜ì„œ  whileë¬¸ì„ ëŒê² ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤ ...

â‡’  ê·¸ëŸ° ì´ë²¤íŠ¸ ì—†ì´, ì´ë²¤íŠ¸ ë©”ì‹œì§€ê°€ ìˆê±´ ì—†ê±´ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì´ ì½”ë”©í•œë‹¤

ì™„ì„±ëœ ë©”ì¸í•¨ìˆ˜ì˜ while ë¬¸

```csharp
while (true)
    {
        if (PeekMessage(&msg, nullptr, 0, 0, PM_REMOVE))
        {
            if (msg.message == WM_QUIT)
                break;

			if (!TranslateAccelerator(msg.hwnd, hAccelTable, &msg))
			{
				TranslateMessage(&msg);
				DispatchMessage(&msg);
			}
        }

		// TODO
        game->Update();
    }
```

- ìŠ¤ë§ˆíŠ¸ í¬ì¸í„° ì‚¬ìš©

```csharp
unique_ptr<Game> game = make_unique<Game>();
```

## íŒŒì¼, ë„ì›€ë§ ë©”ë‰´ ëœ¨ì§€ ì•Šê²Œ í•˜ê¸°

ì—¬ê¸°ê¹Œì§€ ê³¼ì •ì„ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ íŒŒì¼, ë„ì›€ë§ ë©”ë‰´ê°€ ë‹¬ë¦° Client ê°€ ì‹¤í–‰ëœë‹¤

ì´ë¥¼ ì—†ì• ë³´ì

![Untitled](https://user-images.githubusercontent.com/68460391/163723586-c34f25b6-fe3c-4846-8b27-7e6da0e23b0e.png)

 - Client.cpp ì—ì„œ `MyRegisterClass` ë¶€ê·¼ì˜ `wcex.lpszMenuName`  ê°’ì„ ë°”ê¿”ì¤€ë‹¤

```csharp
wcex.lpszMenuName   = nullptr;
```

**ê²°ê³¼)** íŒŒì¼, ë„ì›€ë§ ë©”ë‰´ê°€ ì‚¬ë¼ì ¸ **ë§ë”í•´ì§„** Client.exe ì‹¤í–‰ ê²°ê³¼

![Untitled](https://user-images.githubusercontent.com/68460391/163723606-0cd46cb3-671c-4eb5-85b4-9c7c1ab715cb.png)
