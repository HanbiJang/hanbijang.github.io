---
layout: post
title: 5ê°• ì“°ë ˆë“œ ìƒì„±

categories: [GameServer]
tags: [GameServer]
render_with_liquid: false
---



# 5ê°• ì“°ë ˆë“œ ìƒì„±

**ServerCore íŒŒì¼ì˜ Program.cs (ì¤‘ìš”) ì—ì„œ**

ë‹¤ìŒ ì½”ë”©

```csharp
using System;
using System.Threading;

namespace ServerCore
{
    class Program
    {
        static void MainThread()
        {
            Console.WriteLine("Hello Thread!");
        }

        static void Main(string[] args)
        {
            Thread t = new Thread(MainThread); //MainThread ìŠ¤ë ˆë“œ ìƒì„± (ì„œë¸Œ ì§ì›)
            t.Start(); //ì¼ì„ í•˜ë¼ê³  ëª…ë ¹. (ìŠ¤ë ˆë“œ ì‹¤í–‰)

            Console.WriteLine("Hello Main!");
        }
    }
}
```

C#ì˜ ìŠ¤ë ˆë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì•ì—ì„œ ì‹¤í–‰ë˜ê²Œ ë§Œë“¤ì–´ì§„ë‹¤ (í´ ê·¸ë¼ìš´ë“œ) â†” ë°±ê·¸ë¼ìš´ë“œ

```csharp
t.IsBackground = true;
```

## **ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰**

```csharp
static void MainThread()
        {
            while(true)
            Console.WriteLine("Hello Thread!");
        }

static void Main(string[] args)
        {
            Thread t = new Thread(MainThread); //MainThread ìŠ¤ë ˆë“œ ìƒì„± (ì„œë¸Œ ì§ì›)
            t.IsBackground = true;
            t.Start(); //ì¼ì„ í•˜ë¼ê³  ëª…ë ¹. (ìŠ¤ë ˆë“œ ì‹¤í–‰)

            Console.WriteLine("Hello Main!");
        }
```

- ë‹¤ìŒê³¼ ê°™ë‹¤ë©´ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ìŠ¤ë ˆë“œëŠ” í´ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ìŠ¤ë ˆë“œê°€ ëë‚˜ë©´ **ìë™ ì¢…ë£Œ**ë¨



## ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ì¢…ë£Œ ëŒ€ê¸°í•˜ê¸°

```csharp
Console.WriteLine("Waiting for Thread!");
t.Join();
```

## ìŠ¤ë ˆë“œ ì´ë¦„ ì„¤ì •

```csharp
t.Name = "Test Background Thread";
```

ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸ ê°€ëŠ¥

![Untitled](https://user-images.githubusercontent.com/68460391/163686796-887519aa-35ee-4a5c-b25a-a96eeeef60b0.png)
)

## ìŠ¤ë ˆë“œí’€ë§ (ë‹¨ê¸°ì•Œë°” ê³ ìš©)

```csharp
static void MainThread(object state)
        {
            for(int i=0; i<5; i++)
            Console.WriteLine("Hello Thread!");
        }

static void Main(string[] args)
        {
            ThreadPool.QueueUserWorkItem(MainThread);//ë‹¨ê¸°ì•Œë°” ëª¨ì§‘
            //ë°±ê·¸ë¼ìš´ë“œë¡œ ëŒì•„ê°€ëŠ” ìŠ¤ë ˆë“œ

            while (true) { }
        }
```

- ê²°ê³¼:  ìŠ¤ë ˆë“œ ì—…ë¬´ë¥¼ ë‹¤ ì‹¤í–‰í•œ ë‹¤ìŒ ì¢…ë£Œë˜ì§€ ì•Šê³  ì§€ì†

![Untitled](https://user-images.githubusercontent.com/68460391/163686827-c00c1dae-7296-4dd3-ad33-dbf6b45cf546.png)

**ì›ë¦¬**

ì´ë¯¸ ìŠ¤ë ˆë“œë“¤ì´ ë§ˆë ¨ë˜ì–´ìˆìŒ (ì§ì› ê³ ìš©ì´ ì™„ë£Œ) â‡’ ìŠ¤ë ˆë“œ ëŒ€ê¸°ì†Œì—ì„œ ëŒ€ê¸°ì¤‘ì¸ ìƒíƒœ

ìŠ¤ë ˆë“œì˜ í• ì¼ ì‹¤í–‰ â‡’ ìŠ¤ë ˆë“œì˜ í• ì¼ì´ ëë‚˜ë©´, ë‹¤ì‹œ ìŠ¤ë ˆë“œ ëŒ€ê¸°ì†Œ ë“¤ì–´ê°€ì„œ ëŒ€ê¸°í•¨

**ì£¼ì˜ ì **

ê¸°ì¡´ì— ìˆë˜ í’€ì—ì„œ í™œìš©ì„ í•˜ëŠ” ê²ƒì´ë¯€ë¡œ, í’€ì— ë¹„í•´ì„œ ì¼ê°ì´ ë§ì„ ì‹œ

ë¨¹í†µì´ ë  ìˆ˜ê°€ ìˆë‹¤ (ì˜ˆ- ë¬´í•œë£¨í”„ ì¼ê°)

= ê¸°ì¡´ ì¸ë ¥ì´ ëŒì•„ì˜¤ì§€ ì•ŠëŠ” ê²½ìš°

### cf) ì˜¤ë¸Œì íŠ¸ í’€ë§

ì˜¤ë¸Œì íŠ¸ë¥¼ í’€ì— ëŒ€ê¸°ì‹œì¼°ë‹¤ê°€ í•„ìš”í• ë•Œê°€ ë˜ë©´ ì¬ì‚¬ìš©í•¨

ì´ì™€ ê°™ì€ ì›ë¦¬ì„

### ìŠ¤ë ˆë“œê°€ ë„ˆ~ë¬´ ë§ì„ ì‹œ

```csharp
for (int i = 0; i < 1000; i++) {
                Thread t = new Thread(MainThread); //MainThread ìŠ¤ë ˆë“œ ìƒì„± (ì„œë¸Œ ì§ì›)
                //t.Name = "Test Background Thread";
                t.IsBackground = true;
                t.Start(); //ì¼ì„ í•˜ë¼ê³  ëª…ë ¹. (ìŠ¤ë ˆë“œ ì‹¤í–‰)
            }
```

- 1000ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ë§Œë“¤ì–´ì„œ ì¼ì„ ì‹œí‚¤ëŠ” ì¤‘

**ì–´ë–¨ê¹Œ?**

ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•´ì„œ ì¼ì„ ì‹œí‚¤ëŠ” ì¼ì´

ìŠ¤ë ˆë“œê°€ ì‹¤ì œë¡œ í•´ì•¼ í•  ì¼ì„ í•˜ëŠ” ê²ƒë³´ë‹¤ ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦´ ê²ƒ â‡’ ğŸ¤®ìµœì•…!

### ì˜ì˜ ëŒì•„ì˜¤ì§€ ì•ŠëŠ” ìŠ¤ë ˆë“œ

ì¼ê° (hello thread 5ë²ˆ ì¶œë ¥)

```csharp
static void MainThread(object state)
        {
            for(int i=0; i<5; i++)
            Console.WriteLine("Hello Thread!");
        }
```

ìŠ¤ë ˆë“œ ì¸ë ¥ ì‚¬ë¬´ì†Œ

```csharp
static void Main(string[] args)
        {
            ThreadPool.SetMinThreads(1, 1); //ìµœì†Œ ìŠ¤ë ˆë“œ 1ê°œ
            ThreadPool.SetMaxThreads(5, 5); //ìµœëŒ€ ìŠ¤ë ˆê·¸ 5ê°œ ì„¤ì •

            for (int i = 0; i < 5; i++) {
                //objë¥¼ ë°›ì•„ì„œ ë¬´í•œë£¨í”„ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•´ì¤Œ
                ThreadPool.QueueUserWorkItem((obj)=> { while (true) { } });
            }
            ThreadPool.QueueUserWorkItem(MainThread);//ë‹¨ê¸°ì•Œë°” ëª¨ì§‘
            //ì¼ê° (hello thread 5ë²ˆ ì¶œë ¥)
				}
```

**í•´ì„**

```csharp
for (int i = 0; i < 5; i++) {
                //objë¥¼ ë°›ì•„ì„œ ë¬´í•œë£¨í”„ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•´ì¤Œ
                ThreadPool.QueueUserWorkItem((obj)=> { while (true) { } });
            }
```

ìŠ¤ë ˆë“œê°€ 5ê°œê°€ ì¡´ì¬í•¨.

ì´ ë¶€ë¶„ì—ì„œ 5ê°œì˜ ìŠ¤ë ˆë“œê°€ ë¬´í•œ ë£¨í”„ë¥¼ ëŒê³ ìˆì–´ ë‚¨ëŠ” ìŠ¤ë ˆë“œê°€ ì—†ìœ¼ë¯€ë¡œ ì¼ê°ì„ ìˆ˜í–‰í•  ìŠ¤ë ˆë“œê°€ ì—†ì–´ì„œ **ë¨¹í†µì´ ëœë‹¤**

## Task â‡’ ìŠ¤ë ˆë“œì˜ **ë¨¹í†µ** ë‹¨ì  ê·¹ë³µ

**ê²°ê³¼:** ë¨¹í†µì´ ë˜ëŠ” ì¼ê°ì´ ìˆì–´ë„, MainThread ì¼ë“¤ì„ ì¼ë‹¨ ì²˜ë¦¬í•˜ê²Œ ë  ê²ƒ

```csharp
Task t = new Task(() => { while (true) { } }, TaskCreationOptions.LongRunning);
            //ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ì„ ì•Œë ¤ì¤Œ

t.Start();
```

**Task**

ì§ì›ì´ í•  ì¼ê° ë‹¨ìœ„ë¥¼ ì •í•´ì¤Œ

ìŠ¤ë ˆë“œ í’€ì— ë„£ì–´ì ¸ì„œ ê´€ë¦¬í•˜ê²Œ í™œìš©í•  ê²ƒ

**ì˜µì…˜ ì„¤ëª…**

ğŸ”¥

`TaskCreationOptions.LongRunning` : ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì¼ê°ì„ì„ ì•Œë ¤ì¤Œ

- ì´ ê¸°ëŠ¥ìœ¼ë¡œ ë¨¹í†µì´ ë  ì¼ì´ ì—†ê²Œ ëœë‹¤ (ì´ ì˜µì…˜ì´ ì—†ë‹¤ë©´ ë‹¤ì‹œ ë¨¹í†µì´ ë¨)

```csharp
static void MainThread(object state)
{
            for(int i=0; i<5; i++)
            Console.WriteLine("Hello Thread!");
}
static void Main(string[] args)
{
	ThreadPool.SetMinThreads(1, 1);
   ThreadPool.SetMaxThreads(5, 5);

   for (int i = 0; i < 5; i++) {
	   //ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ì„ ì•Œë ¤ì¤Œ
     Task t = new Task(() => { while (true) { } }, TaskCreationOptions.LongRunning);
     t.Start();
   }
}
```

### * ëŒë‹¤ ì‹*

ê°™ì€ ì˜ë¯¸ì´ë‹¤

```csharp
static void MainThread(object state)
{
	while(true) {}
}

static void Main(string[] args)
{
	ThreadPool.QueueUserWorkItem(MainThread);//ë‹¨ê¸°ì•Œë°” ëª¨ì§‘
}
```

`object` í˜•ì‹ìœ¼ë¡œ `state`ë¥¼ ì¸ìë¡œ ë°›ëŠ” ê²ƒ

== `(obj)=> { while (true) { } }`

```csharp
static void Main(string[] args){
	ThreadPool.QueueUserWorkItem((obj)=> { while (true) { } });
}
```

**ì¸ìê°€ ì—†ëŠ” ëŒë‹¤ ì‹**

`() => { while (true) { } })`
